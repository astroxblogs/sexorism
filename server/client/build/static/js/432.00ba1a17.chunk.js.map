{"version":3,"file":"static/js/432.00ba1a17.chunk.js","mappings":"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","sources":["../node_modules/lucide-react/src/icons/trash-2.ts","components/CommentSection.js"],"sourcesContent":["import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  ['path', { d: 'M3 6h18', key: 'd0wm0j' }],\n  ['path', { d: 'M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6', key: '4alrt4' }],\n  ['path', { d: 'M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2', key: 'v07s0e' }],\n  ['line', { x1: '10', x2: '10', y1: '11', y2: '17', key: '1uufr5' }],\n  ['line', { x1: '14', x2: '14', y1: '11', y2: '17', key: 'xtxkd' }],\n];\n\n/**\n * @component @name Trash2\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJNMyA2aDE4IiAvPgogIDxwYXRoIGQ9Ik0xOSA2djE0YzAgMS0xIDItMiAySDdjLTEgMC0yLTEtMi0yVjYiIC8+CiAgPHBhdGggZD0iTTggNlY0YzAtMSAxLTIgMi0yaDRjMSAwIDIgMSAyIDJ2MiIgLz4KICA8bGluZSB4MT0iMTAiIHgyPSIxMCIgeTE9IjExIiB5Mj0iMTciIC8+CiAgPGxpbmUgeDE9IjE0IiB4Mj0iMTQiIHkxPSIxMSIgeTI9IjE3IiAvPgo8L3N2Zz4K) - https://lucide.dev/icons/trash-2\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst Trash2 = createLucideIcon('trash-2', __iconNode);\n\nexport default Trash2;\n","// client/src/components/CommentSection.js\r\nimport React, { useState } from 'react';\r\nimport axios from 'axios';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { Trash2 } from 'lucide-react'; // An icon for the delete button\r\n\r\n// NEW: Import getSubscriberId and trackUserComment\r\nimport { getSubscriberId } from '../utils/localStorage'; // <-- ADD THIS LINE\r\nimport { trackUserComment } from '../services/api';     // <-- ADD THIS LINE\r\n\r\nconst CommentSection = ({ blogId, initialComments }) => {\r\n    const { t } = useTranslation();\r\n    const [comments, setComments] = useState(initialComments || []);\r\n    const [name, setName] = useState('');\r\n    const [comment, setComment] = useState('');\r\n    const [loading, setLoading] = useState(false);\r\n    const [error, setError] = useState('');\r\n\r\n    const adminToken = localStorage.getItem('adminToken');\r\n\r\n    // NOTE: Your original file didn't have a useEffect to fetch comments.\r\n    // If comments are not showing initially, you might need a useEffect like this:\r\n    /*\r\n    useEffect(() => {\r\n        const fetchComments = async () => {\r\n            try {\r\n                setLoading(true);\r\n                const response = await axios.get(`/api/blogs/${blogId}/comments`);\r\n                setComments(response.data);\r\n                setError('');\r\n            } catch (err) {\r\n                console.error('Failed to fetch comments:', err);\r\n                setError('Failed to load comments.');\r\n            } finally {\r\n                setLoading(false);\r\n            }\r\n        };\r\n        if (blogId) { // Only fetch if blogId is available\r\n            fetchComments();\r\n        }\r\n    }, [blogId]);\r\n    */\r\n\r\n\r\n    const handleSubmit = async (e) => {\r\n        e.preventDefault();\r\n        if (!name.trim() || !comment.trim()) {\r\n            setError('Name and comment cannot be empty.');\r\n            return;\r\n        }\r\n        setLoading(true);\r\n        setError('');\r\n\r\n        try {\r\n            const res = await axios.post(`/api/blogs/${blogId}/comments`, { name, comment });\r\n\r\n            // --- FIX IS HERE: Add res.data.comment, not res.data ---\r\n            setComments([...comments, res.data.comment]);\r\n\r\n            setName('');\r\n            setComment('');\r\n\r\n            // NEW: Track user behavior for inferred interests\r\n            const subscriberId = getSubscriberId();\r\n            if (subscriberId) {\r\n                try {\r\n                    await trackUserComment(subscriberId, blogId);\r\n                    console.log(`Comment behavior for blog ${blogId} tracked for subscriber:`, subscriberId);\r\n                } catch (trackingError) {\r\n                    console.error('Failed to track comment for personalization:', trackingError);\r\n                }\r\n            }\r\n\r\n        } catch (err) {\r\n            console.error(\"Error posting comment:\", err);\r\n            setError('Failed to post comment. Please try again.');\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleDelete = async (commentId) => {\r\n        // IMPORTANT: Replace window.confirm with a custom modal for better UX and consistency\r\n        // (as per general instructions for Canvas/Immersive documents)\r\n        if (!window.confirm(t(\"Are you sure you want to delete this comment?\"))) {\r\n            return;\r\n        }\r\n\r\n        try {\r\n            // This is the correct URL for DELETING a comment\r\n            await axios.delete(`/api/blogs/${blogId}/comments/${commentId}`, {\r\n                headers: { Authorization: `Bearer ${adminToken}` }\r\n            });\r\n            setComments(comments.filter(c => c._id !== commentId));\r\n        } catch (err) {\r\n            console.error(\"Error deleting comment:\", err);\r\n            // IMPORTANT: Replace alert with a custom message box\r\n            alert(t(\"Failed to delete comment.\"));\r\n        }\r\n    };\r\n\r\n    return (\r\n        <section id=\"comments\" className=\"mt-10 pt-6 border-t dark:border-gray-700\">\r\n            <h3 className=\"text-2xl font-bold mb-4\">{t('comment')} ({comments.length})</h3>\r\n\r\n            <form onSubmit={handleSubmit} className=\"flex flex-col md:flex-row gap-4 mb-8\">\r\n                <input\r\n                    className=\"border border-gray-300 dark:border-gray-700 rounded px-3 py-2 w-full md:w-1/4 focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n                    placeholder={t('name')}\r\n                    value={name}\r\n                    onChange={(e) => setName(e.target.value)}\r\n                    required\r\n                />\r\n                <input\r\n                    className=\"border border-gray-300 dark:border-gray-700 rounded px-3 py-2 flex-1 focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n                    placeholder={t('Comment here')}\r\n                    value={comment}\r\n                    onChange={(e) => setComment(e.target.value)}\r\n                    required\r\n                />\r\n                <button\r\n                    className=\"bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded font-semibold transition-colors disabled:bg-blue-400\"\r\n                    type=\"submit\"\r\n                    disabled={loading}\r\n                >\r\n                    {loading ? 'Submitting...' : t('submit')}\r\n                </button>\r\n            </form>\r\n\r\n            {error && <p className=\"text-red-500 text-sm mb-4\">{error}</p>}\r\n\r\n            <div className=\"space-y-4\">\r\n                {comments.map((c) => (\r\n                    <div key={c._id} className=\"rounded-lg bg-gray-100 dark:bg-gray-800 p-4 flex justify-between items-start\">\r\n                        <div>\r\n                            <p className=\"font-bold text-gray-800 dark:text-gray-200 mb-1\">{c.name}</p>\r\n                            <p className=\"text-gray-700 dark:text-gray-300 mb-2\">{c.comment}</p>\r\n                            <p className=\"text-xs text-gray-500\">{new Date(c.timestamp).toLocaleString()}</p>\r\n                        </div>\r\n                        {adminToken && (\r\n                            <button\r\n                                onClick={() => handleDelete(c._id)}\r\n                                className=\"text-red-500 hover:text-red-700 p-1 rounded-full hover:bg-red-100 dark:hover:bg-red-900/50\"\r\n                                aria-label=\"Delete comment\"\r\n                            >\r\n                                <Trash2 size={16} />\r\n                            </button>\r\n                        )}\r\n                    </div>\r\n                ))}\r\n            </div>\r\n        </section>\r\n    );\r\n};\r\n\r\nexport default CommentSection;"],"names":["Trash2","createLucideIcon","d","key","x1","x2","y1","y2","_ref","blogId","initialComments","t","useTranslation","comments","setComments","useState","name","setName","comment","setComment","loading","setLoading","error","setError","adminToken","localStorage","getItem","_jsxs","id","className","children","length","onSubmit","async","e","preventDefault","trim","res","axios","post","concat","data","subscriberId","getSubscriberId","trackUserComment","console","log","trackingError","err","_jsx","placeholder","value","onChange","target","required","type","disabled","map","c","Date","timestamp","toLocaleString","onClick","window","confirm","delete","commentId","headers","Authorization","filter","_id","alert","handleDelete","size"],"sourceRoot":""}